---
applications:
  - name: efk-fluent
    buildpacks:
      - https://github.com/cloudfoundry/apt-buildpack
      - https://github.com/cloudfoundry/python-buildpack  # apt-buildpack is a supply buildpack and cannot run alone
    default-route: false
    health-check-type: process
    memory: 128M
    path: fluent
    routes:
      - route: datagov-logdrain.apps.internal
    services:
      - efk-elasticsearch
  - name: efk-logstash
    default-route: false
    docker:
      image: adborden/datagov-logstash:7.4.2
    env:
      ES_REGION: us-gov-west-1
      _JAVA_OPTIONS: -Xms512m -Xmx512m
    health-check-type: process
    memory: 512M
    path: logstash
    command: /usr/share/logstash/bin/start.sh
    routes:
      - route: datagov-logstash.apps.internal
    services:
      - efk-elasticsearch
  - name: efk-kibana
    default-route: false
    memory: 128M
    path: kibana
    services:
      - efk-elasticsearch
      - efk-kibana-secrets
    routes:
      - route: logs-datagov.app.cloud.gov
